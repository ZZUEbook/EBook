<!DOCTYPE html>
<html>
	<head>
		<!--
        	作者：offline
        	时间：2018-09-07
        	描述：用户注册
        -->
		<meta charset="UTF-8">
		<title>用户注册</title>
		 <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
		 <script src="https://code.jquery.com/jquery.js"></script>
		 <script src="/static/ebookstore/js/bootstrap.min.js"></script>
		 <link href="/static/ebookstore/css/bootstrap.min.css" rel="stylesheet" media="screen">
        <link href="/static/ebookstore/css/bootstrap-responsive.min.css" rel="stylesheet" media="screen">
        <link href="/static/ebookstore/css/styles.css" rel="stylesheet" media="screen">
        <script src="/static/ebookstore/js/modernizr-2.6.2-respond-1.1.0.min.js"></script>
		<style>.col-center-block {float: none;display: block;margin-left: auto;margin-right: auto;}
		</style>
		<style type="text/css">
			body{
				margin: 0;
				background-image: url(/static/ebookstore/img/背景.jpg);
				background-size: cover;
			}
			div{
				margin: auto;
			}
		</style>
	</head>
	<body>
		<nav id="navbar-example" class="navbar navbar-inverse navbar navbar-fixed-top navbar-has-shadow" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed " data-toggle="collapse"
                        data-target=".bs-js-navbar-scrollspy">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">eBookStore</a>
            </div>
            <div class="collapse navbar-collapse bs-js-navbar-scrollspy">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="index">主页</a></li>
                    
                </ul>
                    
            </div>
        </div>
   </nav>
   	<div align="center">
			<div class="block" style="width: 50%">
				<div class="navbar navbar-inner block-header">
					<div class="muted pull-left">注册</div>
				</div>
				<form class="form-horizontal">
					<fieldset>
						<div class="control-group" align="left" style="margin: auto;">
							<label class="control-label" for="focusedInput">姓名</label>
							<div class="controls">
								<input class="input-xlarge focused" id="focusedInput" name="username" type="text" value="">
							</div>
						</div>
						<div class="control-group" align="left" style="margin: auto;">
							<label class="control-label" for="focusedInput">邮箱</label>
							<div class="controls">
								<input class="input-xlarge focused" id="focusedInput" name="mail" type="text" value="">
							</div>
						</div>
						<div class="control-group" align="left" style="margin: auto;">
							<label class="control-label" for="focusedInput">电话</label>
							<div class="controls">
								<input class="input-xlarge focused" id="focusedInput" name="telephone" type="text" value="">
							</div>
						</div>
						<div class="control-group" align="left" style="margin: auto;">
							<label class="control-label" for="focusedInput">地址</label>
							<div class="controls">
								<input class="input-xlarge focused" id="focusedInput" name="address" type="text" value="">
							</div>
						</div>
						<div class="control-group" align="left" style="margin: auto;">
							<label class="control-label" for="focusedInput">密码</label>
							<div class="controls">
								<input class="input-xlarge focused"  id="focusedInput" name="password" type="password" value="">
							</div>
						</div>
						<div class="control-group" align="left" style="margin: auto;">
							<label class="control-label" for="focusedInput">确认密码</label>
							<div class="controls">
								<input class="input-xlarge focused" id="focusedInput" name="password2" type="password" value="">
							</div>
						</div>
						<div class="btn-group" role="group">
							<button id="register" class="btn btn-primary" style="width:100px;height:30px">注册</button>
						</div>
					</fieldset>
				</form>
			</div>
		</div>
		<link href="/static/ebookstore/css/datepicker.css" rel="stylesheet" media="screen">
		<link href="/static/ebookstore/css/uniform.default.css" rel="stylesheet" media="screen">
		<link href="/static/ebookstore/css/chosen.min.css" rel="stylesheet" media="screen">

		<link href="/static/ebookstore/css/bootstrap-wysihtml5.css" rel="stylesheet" media="screen">

		<script src="/static/ebookstore/js/jquery-1.9.1.js"></script>
		<script src="/static/ebookstore/js/jquery.uniform.min.js"></script>
		<script src="/static/ebookstore/js/chosen.jquery.min.js"></script>
		<script src="/static/ebookstore/js/bootstrap-datepicker.js"></script>
		<script src="/static/ebookstore/js/wysihtml5-0.3.0.js"></script>
		<script src="/static/ebookstore/js/bootstrap-wysihtml5.js"></script>
		<script src="/static/ebookstore/js/jquery.bootstrap.wizard.min.js"></script>
		<script type="text/javascript" src="/static/ebookstore/js/jquery.validate.min.js"></script>
		<script src="/static/ebookstore/js/form-validation.js"></script>
		<script src="/static/ebookstore/js/scripts.js"></script>
    <script type="text/javascript">
			window.onload = function() {
				var nameElement = document.querySelector("input[name='username']");
				var passwordElement = document.querySelector("input[name='password']");
				var /static/ebookstore/css = document.querySelector("input[name='remember']");
				var login = document.querySelector("#loginbutton");
				login.onclick = function() {
					var name = nameElement.value,
						password = passwordElement.value;
					if(name.length == 0) {
						alert("用户名不能为空");
						console.log(name);
						return;
					}
					if(password.length == 0) {
						alert("密码不能为空");
						return;
					}

					$.ajax({
						url: "/ebookstore/register",
						method: "post",
						data: {
							name: name,
							password: password
						},
						error: function() {
							alert('登录失败');
						},
						success: function(data) {
							switch(Number(data)) {
								case 1:
								    /*
									if(/static/ebookstore/css.value == true) {
										document.cookie =
											`name=${encodeURIComponent(name)};expires=${new Date(Date.now()+30*86400*1000)}`;
										document.cookie =
											`password=${encodeURIComponent(password)};expires=${new Date(Date.now()+30*86400*1000)}`;
									}
									*/
									location.href = "/ebookstore/index";
									break;
								case 0:
									alert("用户名或密码不正确！");
									nameElement.value = "";
									passwordElement.value = "";
									nameElement.focus();
									break;
								case -1:
									alert("你的帐户已被冻结！");
									break;
							}
						}
					});
				}

			}
		</script>
    <script type="text/javascript">
			window.onload = function() {
				var nameEle = document.querySelector("input[name='username']"),
					mailEle = document.querySelector("input[name='mail']"),
					telephoneEle = document.querySelector("input[name='telephone']"),
					addressEle = document.querySelector("input[name='address']"),
					passwordEle = document.querySelector("input[name='password']"),
					password2Ele = document.querySelector("input[name='password2']"),
					register = document.getElementById("register");
				register.onclick = function(e) {
					var e = e || window.event;
					e.preventDefault();
					var name = nameEle.value,
						mail = mailEle.value,
						telephone = telephoneEle.value,
						address = addressEle.value,
						password = passwordEle.value,
						password2 = password2Ele.value;
					if(name.length == 0) {
						alert("用户名不能为空");
						return;
					}
					if(mail.length == 0) {
						alert("邮箱不能为空");
						return;
					}
					if(telephone.length == 0) {
						alert("电话不能为空");
						return;
					}
					if(address.length == 0) {
						alert("地址不能为空");
						return;
					}
					if(password.length == 0) {
						alert("密码不能为空");
						return;
					}
					if(password2.length == 0) {
						alert("密码确认不能为空");
						return;
					}
					if(password !== password2) {
						alert("两次密码输入不一致");
						return;
					}

					$.ajax({
						url: "/ebookstore/register",
						method: "post",
						data: {
							name: name,
							mail: mail,
							telephone: telephone,
							address: address,
							password: password
						},
						error: function() {
							alert('注册失败');
						},
						success: function(data) {
							switch(Number(data)) {
								case 1:
									document.cookie =
										`name=${encodeURIComponent(name)};expires=${new Date(Date.now()+30*86400*1000)}`;
									document.cookie =
										`password=${encodeURIComponent(password)};expires=${new Date(Date.now()+30*86400*1000)}`;
									location.href = "./index";
									break;
								case 0:
									alert("用户已存在！");
									nameElement.value = "";
									nameElement.focus();
									break;
                                case -1:
                                    alert("Http 500");

							}
						}
					});
				}
			}
		</script>
	</body>
</html>
